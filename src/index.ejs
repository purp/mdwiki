<!DOCTYPE html>
<html>
  <% 
    var pkg = grunt.config('pkg');
    var data = grunt.config('data');
    var console_log = grunt.log.writeln;
    var purpose = { dev: 'debugging', prod: 'release' }[data.mode];
    var isDevMode = (data.mode === 'dev');
  %><!--
    This is <%= pkg.title %> v<%= pkg.version %> file, created for <%= purpose %> purpose
    (C) 2013-2014 by <%= pkg.author.name %> and contributors. This software is licensed
    under the terms of the <%= pkg.license.name %> license.
    See <%= pkg.license.url %> for more detail.
    See <%= pkg.repository.url %> for a copy of the source code.
  -->
  <head>
    <title><%= pkg.title %></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="fragment" content="!">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <meta charset="UTF-8">
    <% 
    console_log(`Building '${data.destination}' for '${purpose}'\n`);

    const wrapInComments = (name, content) => (isDevMode ? `<!-- START ${name} -->\n${content}<!-- END ${name} -->\n` : content);
    
    var output = '';

    output += isDevMode ? `<script type="text/javascript">window.MDwikiEnableDebug = true;</script>\n` : '';
    
    // INLINE CSS
    output += wrapInComments(data.cssMain, `<style id='style:${data.cssMain}'>\n${grunt.file.read(data.cssMain)}</style>\n`);
    
    // INLINE SCRIPTS
    output += wrapInComments(data.jsLibs, `<script type="text/javascript">\n${grunt.file.read(data.jsLibs)}</script>\n`);
    output += wrapInComments(data.jsMain, `<script type="text/javascript">\n${grunt.file.read(data.jsMain)}</script>\n`);

    %><%= output %><% console_log(`Generated '${data.destination}' from '${data.template}'\n`); %>
  </head>
  <body>

    <noscript>
      This website requires Javascript to be enabled. Please turn on Javascript
      and reload the page.
    </noscript>

    <div id="md-all">
    </div>
    <%= isDevMode ? `<script src="//localhost:35729/livereload.js"></script>` : '' %>
  </body>
</html>
